---
layout: page
title: proxmox_virtual_environment_backup_job
parent: Resources
subcategory: Virtual Environment
description: |-
  Manages a Proxmox VE cluster backup job. Backup jobs are scheduled tasks that automatically backup VMs and containers according to a defined schedule.
---

# Resource: proxmox_virtual_environment_backup_job

Manages a Proxmox VE cluster backup job. Backup jobs are scheduled tasks that automatically backup VMs and containers according to a defined schedule.

## Example Usage

```terraform
# Simple daily backup job for specific VMs
resource "proxmox_virtual_environment_backup_job" "daily_vm_backup" {
  id       = "daily-vm-backup"
  schedule = "02:00"
  storage  = "local"
  vmid     = "100,101,102"
  mode     = "snapshot"
  compress = "zstd"
  mailto   = "admin@example.com"
}

# Weekly backup of all VMs in a pool with retention policy
resource "proxmox_virtual_environment_backup_job" "weekly_pool_backup" {
  id            = "weekly-pool-backup"
  schedule      = "sun 03:00"
  storage       = "pbs"
  pool          = "production"
  mode          = "snapshot"
  compress      = "zstd"
  prune_backups = "keep-last=3,keep-weekly=4,keep-monthly=6"
  remove        = true
  enabled       = true
}

# Backup all VMs on a specific node
resource "proxmox_virtual_environment_backup_job" "node_backup" {
  id       = "node-backup"
  schedule = "01:00"
  storage  = "local"
  node     = "pve"
  all      = true
  mode     = "stop"
  compress = "gzip"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `id` (String) The unique identifier of the backup job. This will be used as the job ID in Proxmox VE.
- `schedule` (String) The schedule for the backup job in systemd calendar event format. Examples: `02:00`, `sun 03:00`, `0 2 * * *` (daily at 2 AM), `0 */4 * * *` (every 4 hours), `*:0/30` (every 30 minutes).
- `storage` (String) The storage identifier where backups will be stored (e.g., `local`, `pbs`).

### Optional

- `all` (Boolean) Backup all VMs and containers on the node. Mutually exclusive with `vmid` and `pool`.
- `bwlimit` (Number) Bandwidth limit in KiB/s. 0 means unlimited. Use this to prevent storage I/O bottlenecks.
- `compress` (String) The compression algorithm. Options: `0` (no compression), `1` (default compression), `gzip`, `lzo`, `zstd`. Default is `0`.
- `enabled` (Boolean) Enable or disable the backup job. When disabled, the job will not run according to its schedule.
- `exclude_path` (List of String) Array of shell glob patterns to exclude from backup. Example: `["/tmp/**", "/var/log/**"]`
- `fleecing` (Attributes) Backup fleecing configuration. Fleecing caches backup data on fast local storage first, reducing I/O impact on guest VMs. (see [below for nested schema](#nestedatt--fleecing))
- `ionice` (Number) I/O priority when using BFQ scheduler (0-8). Higher values mean lower priority. Default is 7.
- `lockwait` (Number) Maximum time to wait for the global VM lock in minutes. Default is 180 minutes.
- `mailnotification` (String) When to send email notifications. Options: `always` (send on success and failure), `failure` (send only on failure).
- `mailto` (String) Email recipients for notifications. Can be comma-separated email addresses or Proxmox VE user names. Example: `admin@example.com,root`
- `maxfiles` (Number) Maximum number of backup files per VM. **Deprecated:** Use `prune_backups` instead. This option is maintained for backward compatibility.
- `mode` (String) The backup mode. Options: `snapshot` (minimal downtime), `suspend` (suspend during backup), `stop` (stop VM during backup for maximum consistency). Default is `snapshot`.
- `node` (String) The node name where the backup job will run. If not specified, the job can run on any node. Use this to restrict backup execution to a specific node.
- `notes_template` (String) Template for backup notes. Available variables: `{{vmid}}`, `{{guestname}}`, `{{node}}`, `{{cluster}}`. Example: `{{guestname}}-{{cluster}}`
- `pbs_change_detection_mode` (String) Proxmox Backup Server change detection mode for container backups. Options: `data` (hash-based), `metadata` (metadata-based), `legacy` (legacy mode).
- `performance` (Attributes) Performance tuning options for backup operations. (see [below for nested schema](#nestedatt--performance))
- `pigz` (Number) Use pigz instead of gzip for parallel compression. Specify the number of threads (0 means disabled).
- `pool` (String) Backup all VMs and containers in the specified pool. Mutually exclusive with `vmid` and `all`.
- `protected` (Boolean) Mark backups as protected. Protected backups are not removed by pruning and are not counted toward retention limits.
- `prune_backups` (String) Retention policy for backups in the format `keep-last=N,keep-hourly=N,keep-daily=N,keep-weekly=N,keep-monthly=N,keep-yearly=N`. Example: `keep-last=3,keep-daily=7,keep-weekly=4`. Default is `keep-all=1` (keep all backups).
- `remove` (Boolean) Prune old backups according to the `prune_backups` retention policy. When disabled, old backups are not automatically removed.
- `repeat_missed` (Boolean) Run missed backup jobs when the node becomes available. Useful for ensuring backups are not skipped when a node is offline during scheduled time.
- `script` (String) Path to a hook script that will be called during backup lifecycle events (before/after backup, on failure, etc.).
- `starttime` (String) The start time in HH:MM format (24-hour). This works in conjunction with the schedule.
- `stdexcludes` (Boolean) Exclude standard temporary files and logs from the backup. Recommended for most use cases.
- `stopwait` (Number) Maximum time to wait for guest shutdown in minutes when using `stop` mode. Default is 10 minutes.
- `tmpdir` (String) Custom temporary directory for storing backup data during the backup process.
- `vmid` (String) Comma-separated list of VM/container IDs to backup (e.g., `100,101,102`). Mutually exclusive with `all` and `pool`.
- `zstd` (Number) Zstd compression thread count. 0 means half of available CPU cores. Only relevant when compress is set to `zstd`.

<a id="nestedatt--fleecing"></a>
### Nested Schema for `fleecing`

Optional:

- `enabled` (Boolean) Enable backup fleecing for this job.
- `storage` (String) Storage identifier for the fleecing cache. Should be fast local storage.


<a id="nestedatt--performance"></a>
### Nested Schema for `performance`

Optional:

- `max_workers` (Number) Maximum number of concurrent backup workers (1-256). Controls parallel backup operations.
- `pbs_entries_max` (Number) Maximum number of entries for Proxmox Backup Server. Affects memory usage for container backups.

## Import

Import is supported using the following syntax:

```shell
#!/usr/bin/env sh
terraform import proxmox_virtual_environment_backup_job.daily_vm_backup daily-vm-backup
```
